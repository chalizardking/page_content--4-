(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54616,e=>{"use strict";var t=e.i(71645),s=e.i(14272),r=e.i(40143),i=e.i(15823),a=e.i(19273),n=class extends i.Subscribable{#e;#t=void 0;#s;#r;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,a.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,a.hashKey)(t.mutationKey)!==(0,a.hashKey)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#i(),this.#a()}mutate(e,t){return this.#r=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#i(){let e=this.#s?.state??(0,s.getDefaultState)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#a(e){r.notifyManager.batch(()=>{if(this.#r&&this.hasListeners()){let t=this.#t.variables,s=this.#t.context,r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,t,s,r),this.#r.onSettled?.(e.data,null,t,s,r)):e?.type==="error"&&(this.#r.onError?.(e.error,t,s,r),this.#r.onSettled?.(void 0,e.error,t,s,r))}this.listeners.forEach(e=>{e(this.#t)})})}},o=e.i(12598);function l(e,s){let i=(0,o.useQueryClient)(s),[l]=t.useState(()=>new n(i,e));t.useEffect(()=>{l.setOptions(e)},[l,e]);let c=t.useSyncExternalStore(t.useCallback(e=>l.subscribe(r.notifyManager.batchCalls(e)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),d=t.useCallback((e,t)=>{l.mutate(e,t).catch(a.noop)},[l]);if(c.error&&(0,a.shouldThrowError)(l.options.throwOnError,[c.error]))throw c.error;return{...c,mutate:d,mutateAsync:c.mutate}}e.s(["useMutation",()=>l],54616)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},31343,e=>{"use strict";let t=(0,e.i(75254).default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>t],31343)},31171,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["default",()=>t])},64659,e=>{"use strict";var t=e.i(31171);e.s(["ChevronDown",()=>t.default])},23585,e=>{"use strict";let t=(0,e.i(75254).default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);e.s(["MoreVertical",()=>t],23585)},99602,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);e.s(["ArrowUpDown",()=>t],99602)},73375,63059,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>t],73375);var s=e.i(46349);e.s(["ChevronRight",()=>s.default],63059)},39290,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(66027),i=e.i(54616),a=e.i(12598),n=e.i(99602),o=e.i(47163),l=e.i(55436);function c({value:e,onChange:s,placeholder:r="Search...",className:i}){return(0,t.jsxs)("div",{className:(0,o.cn)("relative w-full max-w-md",i),children:[(0,t.jsx)(l.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:18}),(0,t.jsx)("input",{type:"text",value:e,onChange:e=>s(e.target.value),placeholder:r,className:"w-full pl-10 pr-4 py-2.5 text-sm border border-input rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent transition-all"})]})}var d=e.i(73375),u=e.i(63059);function h({currentPage:e,totalPages:s,totalItems:r,itemsPerPage:i,onPageChange:a,className:n}){let l=Math.min(e*i,r),c=e>1,h=e<s;return(0,t.jsxs)("div",{className:(0,o.cn)("flex items-center justify-between gap-4 flex-wrap",n),children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Showing ",(e-1)*i+1," to ",l," of ",r," results"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:()=>a(e-1),disabled:!c,className:(0,o.cn)("flex items-center gap-1 px-3 py-2 text-sm border border-input rounded-lg transition-colors",c?"hover:bg-accent cursor-pointer":"opacity-50 cursor-not-allowed"),children:[(0,t.jsx)(d.ChevronLeft,{size:16}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Previous"})]}),(0,t.jsxs)("button",{onClick:()=>a(e+1),disabled:!h,className:(0,o.cn)("flex items-center gap-1 px-3 py-2 text-sm border border-input rounded-lg transition-colors",h?"hover:bg-accent cursor-pointer":"opacity-50 cursor-not-allowed"),children:[(0,t.jsx)("span",{className:"hidden sm:inline",children:"Next"}),(0,t.jsx)(u.ChevronRight,{size:16})]})]})]})}function m({data:e,columns:r,itemsPerPage:i=10,enableSearch:a=!0,searchPlaceholder:l="Search...",searchKeys:d=[],enableFiltering:u=!1,filterOptions:m=[],filterKey:x,defaultFilterValue:p="All",className:f,getRowId:g=e=>e.id||"",disablePagination:b=!1}){let[y,v]=(0,s.useState)(""),[j,w]=(0,s.useState)(p),[N,C]=(0,s.useState)(1),[M,k]=(0,s.useState)({key:null,direction:null}),S=(e,t)=>t.accessorFn?t.accessorFn(e):t.accessorKey?e[t.accessorKey]:null,O=(0,s.useMemo)(()=>a&&""!==y?e.filter(e=>0===d.length?Object.values(e).some(e=>String(e).toLowerCase().includes(y.toLowerCase())):d.some(t=>{let s=e[t];return Array.isArray(s)?s.some(e=>String(e).toLowerCase().includes(y.toLowerCase())):String(s).toLowerCase().includes(y.toLowerCase())})):e,[e,y,a,d]),L=(0,s.useMemo)(()=>u&&x&&j!==p?O.filter(e=>e[x]===j):O,[O,u,x,j,p]),P=(0,s.useMemo)(()=>M.key&&M.direction?[...L].sort((e,t)=>{let s=r.find(e=>e.id===M.key);if(!s)return 0;let i=S(e,s),a=S(t,s);return i instanceof Date&&a instanceof Date?"asc"===M.direction?i.getTime()-a.getTime():a.getTime()-i.getTime():"string"==typeof i&&"string"==typeof a?"asc"===M.direction?i.localeCompare(a):a.localeCompare(i):"number"==typeof i&&"number"==typeof a?"asc"===M.direction?i-a:a-i:0}):L,[L,M,r]),R=(0,s.useMemo)(()=>{if(b)return P;let e=(N-1)*i,t=e+i;return P.slice(e,t)},[P,N,i,b]),D=Math.ceil(P.length/i);(0,s.useMemo)(()=>{C(1)},[y,j]);let A=e=>"function"==typeof e.header?e.header({column:e}):e.header,K=(e,t)=>{let s=S(e,t);return t.cell?t.cell({row:e,value:s}):Array.isArray(s)?s.join(", "):s instanceof Date?s.toLocaleDateString():String(s??"")},E=r.filter(e=>!e.meta?.hideOnMobile);return(0,t.jsxs)("div",{className:(0,o.cn)("w-full space-y-6",f),children:[(a||u)&&(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[a&&(0,t.jsx)(c,{value:y,onChange:v,placeholder:l,className:"w-full sm:w-auto sm:flex-1 sm:max-w-md"}),u&&m.length>0&&(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("select",{value:j,onChange:e=>w(e.target.value),className:"flex items-center gap-2 px-4 py-2.5 text-sm border border-input rounded-lg bg-background hover:bg-accent transition-colors min-w-[120px] cursor-pointer",children:m.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})})]}),(0,t.jsx)("div",{className:"border border-input rounded-lg overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-muted/50 border-b border-input",children:(0,t.jsx)("tr",{children:r.map(e=>(0,t.jsx)("th",{className:(0,o.cn)("px-6 py-4 text-left text-sm font-medium text-muted-foreground",e.headerClassName),children:e.enableSorting?(0,t.jsxs)("button",{onClick:()=>{var t;let s;return t=e.id,s=r.find(e=>e.id===t),void(s?.enableSorting&&k(e=>{if(e.key===t){if("asc"===e.direction)return{key:t,direction:"desc"};else if("desc"===e.direction)return{key:null,direction:null}}return{key:t,direction:"asc"}}))},className:"flex items-center gap-2 hover:text-foreground transition-colors",children:[A(e),(0,t.jsx)(n.ArrowUpDown,{size:16,className:(0,o.cn)(M.key===e.id&&"text-foreground")})]}):A(e)},e.id))})}),(0,t.jsx)("tbody",{className:"divide-y divide-input",children:0===R.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:r.length,className:"px-6 py-12 text-center text-muted-foreground",children:"No results found"})}):R.map(e=>(0,t.jsx)("tr",{className:"hover:bg-muted/30 transition-colors",children:r.map(s=>(0,t.jsx)("td",{className:(0,o.cn)("px-6 py-4 text-sm",s.className),children:K(e,s)},s.id))},g(e)))})]})})}),(0,t.jsx)("div",{className:"hidden space-y-4",children:0===R.length?(0,t.jsx)("div",{className:"border border-input rounded-lg p-12 text-center text-muted-foreground",children:"No results found"}):R.map(e=>(0,t.jsx)("div",{className:"border border-input rounded-lg p-4 space-y-3 hover:bg-muted/30 transition-colors",children:E.map(s=>{let r=K(e,s);return r?(0,t.jsxs)("div",{className:"flex flex-col gap-1",style:{order:s.meta?.mobileOrder},children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"string"==typeof s.header?s.header:s.id}),(0,t.jsx)("div",{className:"text-sm",children:r})]},s.id):null})},g(e)))}),!b&&P.length>0&&D>1&&(0,t.jsx)(h,{currentPage:N,totalPages:D,totalItems:P.length,itemsPerPage:i,onPageChange:C})]})}var x=e.i(31343);let p=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);var f=e.i(23585),g=e.i(22016),b=e.i(67881),y=e.i(63415);let v=e=>[{id:"name",header:"Chat Query",accessorKey:"name",enableSorting:!0,cell:({value:e,row:s})=>(0,t.jsx)(g.default,{href:`/app/chat/${s.jobId}`,className:"font-medium hover:underline hover:text-primary transition-colors",children:e}),meta:{mobileOrder:1}},{id:"createdAt",header:"Created at",accessorKey:"createdAt",enableSorting:!0,cell:({value:e})=>e.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),meta:{mobileOrder:2}},{id:"actions",header:"",cell:({row:s})=>(0,t.jsxs)(y.DropdownMenu,{children:[(0,t.jsx)(y.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(b.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)(f.MoreVertical,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Open menu"})]})}),(0,t.jsxs)(y.DropdownMenuContent,{align:"end",children:[(0,t.jsx)(y.DropdownMenuItem,{asChild:!0,children:(0,t.jsxs)(g.default,{href:`/app/chat/${s.jobId}`,className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)(x.Play,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"View Chat"})]})}),(0,t.jsxs)(y.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),e?.(s.jobId)},className:"text-destructive focus:text-destructive cursor-pointer",children:[(0,t.jsx)(p,{className:"h-4 w-4 mr-2"}),(0,t.jsx)("span",{children:"Delete"})]})]})]}),headerClassName:"w-[60px]",meta:{hideOnMobile:!1,mobileOrder:4}}];v();var j=e.i(64659);let w=["All","Done","Processing","Error"];function N({value:e,onChange:r,className:i}){let[a,n]=(0,s.useState)(!1),l=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=e=>{l.current&&!l.current.contains(e.target)&&n(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,t.jsxs)("div",{ref:l,className:(0,o.cn)("relative",i),children:[(0,t.jsxs)("button",{onClick:()=>n(!a),className:"flex items-center gap-2 px-4 py-2.5 text-sm border border-input rounded-lg bg-background hover:bg-accent transition-colors min-w-[120px] justify-between",children:[(0,t.jsx)("span",{children:e}),(0,t.jsx)(j.ChevronDown,{size:16,className:(0,o.cn)("text-muted-foreground transition-transform",a&&"rotate-180")})]}),a&&(0,t.jsx)("div",{className:"absolute right-0 mt-2 w-full min-w-[120px] bg-background border border-input rounded-lg shadow-lg z-50 overflow-hidden",children:w.map(s=>(0,t.jsx)("button",{onClick:()=>{r(s),n(!1)},className:(0,o.cn)("w-full text-left px-4 py-2.5 text-sm hover:bg-accent transition-colors",e===s&&"bg-accent font-medium"),children:s},s))})]})}function C({data:e,itemsPerPage:r=5,className:i,disablePagination:a=!1,onDelete:n}){let[l,d]=(0,s.useState)("All"),[u,h]=(0,s.useState)(""),x=(0,s.useMemo)(()=>v(n),[n]),p="All"===l?e:e.filter(e=>e.status===l),f=u?p.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(u.toLowerCase()))):p;return(0,t.jsxs)("div",{className:(0,o.cn)("w-full space-y-6",i),children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,t.jsx)(c,{value:u,onChange:h,placeholder:"Search Chats",className:"w-full sm:w-auto sm:flex-1 sm:max-w-md"}),(0,t.jsx)(N,{value:l,onChange:d})]}),(0,t.jsx)(m,{data:f,columns:x,itemsPerPage:r,enableSearch:!1,getRowId:e=>e.id,disablePagination:a})]})}var M=e.i(34833),k=e.i(65735),S=e.i(31278),O=e.i(46696);function L(e){return"completed"===e?"Done":"failed"===e?"Error":"Processing"}function P(){let{isAuthenticated:e,accessToken:n,isLoading:o}=(0,k.useUser)(),l=!!(e&&n),[c,h]=(0,s.useState)(1),m=(0,a.useQueryClient)(),{data:x,isLoading:p,isFetching:f,error:g}=(0,r.useQuery)({queryKey:["chat-history",n,c],queryFn:()=>(0,M.fetchAllChats)({token:n,skip:(c-1)*10,limit:10}),enabled:l,refetchOnWindowFocus:!1}),y=(0,i.useMutation)({mutationFn:e=>(0,M.deleteChat)({chatId:e,token:n}),onSuccess:()=>{m.invalidateQueries({queryKey:["chat-history"]}),O.toast.success("Chat deleted successfully")},onError:e=>{console.error("Failed to delete chat:",e),O.toast.error("Failed to delete chat. Please try again.")}}),v=(0,s.useMemo)(()=>x?.chats?.length?x.chats.map(e=>({id:e.chat_id,jobId:e.chat_id,name:e.title??e.query,tags:[L(e.status)],createdAt:new Date(e.created_at),status:L(e.status),duration:e.duration})):[],[x]),j=x?.has_more??!1,w=c>1,N=(c-1)*10+1,P=N+(v.length||0)-1;return(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Chat History"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Review your previous chats and keep track of their status."})]})})}),(o||!l)&&(0,t.jsx)("div",{className:"rounded-xl border border-prep-badge-border p-6 text-center text-muted-foreground",children:"Loading..."}),!o&&l&&!x&&p&&(0,t.jsxs)("div",{className:"rounded-xl border border-prep-badge-border p-6 text-center text-muted-foreground flex items-center justify-center gap-2",children:[(0,t.jsx)(S.Loader2,{className:"h-4 w-4 animate-spin"}),"Fetching your chats..."]}),!o&&l&&g&&(0,t.jsx)("div",{className:"rounded-xl border border-destructive/40 bg-destructive/10 p-6 text-destructive text-sm",children:"Unable to load history. Please try again later."}),!o&&l&&!g&&x&&(0,t.jsx)(t.Fragment,{children:0===v.length?(0,t.jsx)("div",{className:"rounded-xl border border-prep-badge-border p-6 text-center text-muted-foreground",children:"No chats yet. Start a conversation to see it here."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C,{data:v,disablePagination:!0,onDelete:e=>{confirm("Are you sure you want to delete this chat?")&&y.mutate(e)}}),(w||j)&&(0,t.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Showing ",N,"-",P]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(b.Button,{variant:"outline",size:"sm",onClick:()=>h(e=>Math.max(1,e-1)),disabled:!w||f,children:[f?(0,t.jsx)(S.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,t.jsx)(d.ChevronLeft,{className:"h-4 w-4 mr-1"}),"Previous"]}),(0,t.jsxs)("span",{className:"flex items-center px-3 text-sm text-muted-foreground",children:["Page ",c]}),(0,t.jsxs)(b.Button,{variant:"outline",size:"sm",onClick:()=>h(e=>e+1),disabled:!j||f,children:["Next",f?(0,t.jsx)(S.Loader2,{className:"h-4 w-4 ml-1 animate-spin"}):(0,t.jsx)(u.ChevronRight,{className:"h-4 w-4 ml-1"})]})]})]})]})})]})}e.s(["default",()=>P],39290)}]);